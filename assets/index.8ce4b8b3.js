var e=Object.defineProperty,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,t=(o,n,a)=>n in o?e(o,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[n]=a,l=(e,l)=>{for(var i in l||(l={}))n.call(l,i)&&t(e,i,l[i]);if(o)for(var i of o(l))a.call(l,i)&&t(e,i,l[i]);return e};import{p as i,S as r}from"./index.889d261a.js";import{S as s}from"./index.be018264.js";import{I as c}from"./index.6d61c9e3.js";import{p as u,P as p}from"./index.679add02.js";import{p as m,m as d}from"./components.fc1d8498.js";import{t as v,i as h,e as g,b as w}from"./shared.6d6b25a1.js";import{_ as f}from"./IconSfc.addeaf96.js";import{q as C,r as y,b,y as T,d as _,o as x,k as O,w as j,h as S,c as k,j as R,a as I,n as z,F as X,O as Y,P,t as $,f as F,p as D,z as M}from"./vendor.bac705d4.js";const U=l(l({show:{type:Boolean,default:!1},images:{type:Array,default:()=>[]},current:{type:String},zoom:{type:[String,Number],default:2},closeable:{type:Boolean,default:!1},"onUpdate:show":{type:Function}},m(i,["loop","indicator","onChange"])),m(u,["lockScroll","teleport","onOpen","onClose","onOpened","onClosed","onRouteChange"]));const q=C({name:"VarImagePreview",components:{[r.name]:r,[s.name]:s,[p.name]:p,[c.name]:c},inheritAttrs:!1,props:U,setup(e){const o=y(!1),n=b((()=>{const{images:o,current:n}=e,a=o.findIndex((e=>e===n));return a>=0?a:0})),a=y(1),t=y(0),l=y(0),i=y(null),r=y(null),s=y(!0);let c=null,u=null,p=null;const m=(e,o)=>{const{clientX:n,clientY:a}=e,{clientX:t,clientY:l}=o;return Math.abs(Math.sqrt((t-n)**2+(l-a)**2))},d=(e,o)=>({clientX:e.clientX,clientY:e.clientY,timestamp:Date.now(),target:o}),h=()=>{a.value=1,t.value=0,l.value=0,s.value=!0,u=null,i.value=null,r.value=null},g=o=>{const{offsetWidth:n,offsetHeight:a}=o,{naturalWidth:t,naturalHeight:l}=o.querySelector(".var-image-preview__image");return{width:n,height:a,imageRadio:l/t,rootRadio:a/n,zoom:v(e.zoom)}},w=(e,o,n)=>e+o>=n?n:e+o<=-n?-n:e+o,f=()=>{var o;if(a.value>1)return h(),void setTimeout((()=>{var o;return null==(o=e["onUpdate:show"])?void 0:o.call(e,!1)}),200);null==(o=e["onUpdate:show"])||o.call(e,!1)};return T((()=>e.show),(e=>{o.value=e}),{immediate:!0}),{initialIndex:n,popupShow:o,scale:a,translateX:t,translateY:l,canSwipe:s,transitionTimingFunction:i,transitionDuration:r,handleTouchstart:o=>{p&&window.clearTimeout(p);const{touches:n}=o,t=d(n[0],o.currentTarget);c=t,(e=>!!u&&m(u,e)<=12&&e.timestamp-u.timestamp<=200&&u.target===e.target)(t)?a.value>1?h():(a.value=v(e.zoom),s.value=!1,u=null,window.setTimeout((()=>{i.value="linear",r.value="0s"}),200)):u=t},handleTouchmove:e=>{if(!u)return;const o=e.currentTarget,{touches:n}=e,i=d(n[0],o);if(a.value>1){const e=i.clientX-u.clientX,n=i.clientY-u.clientY,a=(e=>{const{zoom:o,imageRadio:n,rootRadio:a,width:t,height:l}=g(e);if(!n)return 0;const i=n>a?l/n:t;return Math.max(0,(o*i-t)/2)/o})(o),r=(e=>{const{zoom:o,imageRadio:n,rootRadio:a,width:t,height:l}=g(e);if(!n)return 0;const i=n>a?l:t*n;return Math.max(0,(o*i-l)/2)/o})(o);t.value=w(t.value,e,a),l.value=w(l.value,n,r)}u=i},handleTouchend:e=>{p=window.setTimeout((()=>{var o;o=e.target,c&&u&&m(c,u)<=12&&(o===c.target||o.parentNode===c.target)&&f(),c=null}),200)},close:f}}}),A=["src","alt"],B={key:0,class:"var-image-preview__indicators"};var H=f(q,[["render",function(e,o,n,a,t,l){const i=_("var-swipe-item"),r=_("var-swipe"),s=_("var-icon"),c=_("var-popup");return x(),O(c,{class:"var-image-preview__popup","var-image-preview-cover":"",transition:"var-fade",show:e.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":e.lockScroll,teleport:e.teleport,onOpen:e.onOpen,onClose:e.onClose,onClosed:e.onClosed,onOpened:e.onOpened,onRouteChange:e.onRouteChange},{default:j((()=>[S(r,P({class:"var-image-preview__swipe","var-image-preview-cover":"",touchable:e.canSwipe,indicator:e.indicator&&e.images.length>1,"initial-index":e.initialIndex,loop:e.loop,onChange:e.onChange},e.$attrs),{default:j((()=>[(x(!0),k(X,null,R(e.images,(n=>(x(),O(i,{class:"var-image-preview__swipe-item","var-image-preview-cover":"",key:n},{default:j((()=>[I("div",{class:"var-image-preview__zoom-container",style:z({transform:`scale(${e.scale}) translate(${e.translateX}px, ${e.translateY}px)`,transitionTimingFunction:e.transitionTimingFunction,transitionDuration:e.transitionDuration}),onTouchstart:o[0]||(o[0]=(...o)=>e.handleTouchstart&&e.handleTouchstart(...o)),onTouchmove:o[1]||(o[1]=(...o)=>e.handleTouchmove&&e.handleTouchmove(...o)),onTouchend:o[2]||(o[2]=(...o)=>e.handleTouchend&&e.handleTouchend(...o))},[I("img",{class:"var-image-preview__image",src:n,alt:n},null,8,A)],36)])),_:2},1024)))),128))])),indicator:j((({index:o,length:n})=>[Y(e.$slots,"indicator",{index:o,length:n},(()=>[e.indicator&&e.images.length>1?(x(),k("div",B,$(o+1)+" / "+$(n),1)):F("v-if",!0)]))])),_:3},16,["touchable","indicator","initial-index","loop","onChange"]),Y(e.$slots,"close-icon",{},(()=>[e.closeable?(x(),O(s,{key:0,class:"var-image-preview__close-icon",name:"close-circle","var-image-preview-cover":"",onClick:e.close},null,8,["onClick"])):F("v-if",!0)]))])),_:3},8,["show","lock-scroll","teleport","onOpen","onClose","onClosed","onOpened","onRouteChange"])}]]);let N;function W(e){if(!h)return;W.close();const o=g(e)?{images:[e]}:w(e)?{images:e}:e,n=D(o);n.teleport="body",N=n;const{unmountInstance:a}=d(H,n,{onClose:()=>{var e;return null==(e=n.onClose)?void 0:e.call(n)},onClosed:()=>{var e;null==(e=n.onClosed)||e.call(n),a(),N===n&&(N=null)},onRouteChange:()=>{a(),N===n&&(N=null)},"onUpdate:show":e=>{n.show=e}});n.show=!0}W.close=()=>{if(null!=N){const e=N;N=null,M().then((()=>{e.show=!1}))}},H.install=function(e){e.component(H.name,H)},W.install=function(e){e.component(H.name,H)},W.Component=H;export{W as I};
