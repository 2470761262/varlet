var t=Object.defineProperty,e=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(e,a,r)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r;import{i as l,f as o}from"./elements.f945da86.js";import{r as i,h as c,o as s}from"./shared.6d6b25a1.js";const u="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",d=[],m=[],f=s(100),y={loading:u,error:u,attempt:3,throttleWait:300,events:["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"]};let p=c(w,y.throttleWait);function A(t,e){"background-image"===t._lazy.arg?t.style.backgroundImage=`url(${e})`:t.setAttribute("src",e)}function g(t,e){A(t,e),t._lazy.state="success",E(t),w()}function z(t){var e;m.includes(t)||(m.push(t),null==(e=y.events)||e.forEach((e=>{t.addEventListener(e,p,{passive:!0})})))}function h(t,l){var o,i,c;const s={loading:null!=(o=t.getAttribute("lazy-loading"))?o:y.loading,error:null!=(i=t.getAttribute("lazy-error"))?i:y.error,attempt:t.getAttribute("lazy-attempt")?Number(t.getAttribute("lazy-attempt")):y.attempt};t._lazy=((t,l)=>{for(var o in l||(l={}))a.call(l,o)&&n(t,o,l[o]);if(e)for(var o of e(l))r.call(l,o)&&n(t,o,l[o]);return t})({src:l.value,arg:l.arg,currentAttempt:0,state:"pending",attemptLock:!1},s),A(t,u),null==(c=y.filter)||c.call(y,t._lazy)}function v(t,e){const a=new Image;a.src=e,t._lazy.preloadImage=a,a.addEventListener("load",(()=>{t._lazy.attemptLock=!1,f.add(e),g(t,e)})),a.addEventListener("error",(()=>{t._lazy.attemptLock=!1,t._lazy.currentAttempt>=t._lazy.attempt?function(t){t._lazy.error&&A(t,t._lazy.error),t._lazy.state="error",E(t),w()}(t):_(t)}))}function _(t){if(t._lazy.attemptLock)return;t._lazy.attemptLock=!0,t._lazy.currentAttempt++;const{src:e}=t._lazy;if(f.has(e))return g(t,e),void(t._lazy.attemptLock=!1);!function(t){t._lazy.loading&&A(t,t._lazy.loading),w()}(t),v(t,e)}async function b(t){await l(t)&&_(t)}function w(){d.forEach((t=>b(t)))}function E(t){i(d,t),0===d.length&&(m.forEach((t=>{var e;null==(e=y.events)||e.forEach((e=>{t.removeEventListener(e,p)}))})),m.length=0)}async function L(t,e){h(t,e),await async function(t){!d.includes(t)&&d.push(t),o(t).forEach(z),await b(t)}(t)}const k={mounted:L,unmounted:E,updated:async function(t,e){!function(t,e){const{src:a,arg:r}=t._lazy;return a!==e.value||r!==e.arg}(t,e)?d.includes(t)&&await b(t):await L(t,e)},install(t,e){!function(t={}){const{events:e,loading:a,error:r,attempt:n,throttleWait:l,filter:o}=t;y.events=null!=e?e:y.events,y.loading=null!=a?a:y.loading,y.error=null!=r?r:y.error,y.attempt=null!=n?n:y.attempt,y.throttleWait=null!=l?l:y.throttleWait,y.filter=o}(e),p=c(w,y.throttleWait),t.directive("lazy",this)}};export{k as L};
